<?php
require_once '../fachada/TerminalPronostico.php';

$lat = isset($_POST['lat'])? $_POST['lat'] : null;
$long = isset($_POST['long'])? $_POST['long'] : null;

// Obligación del ingreso de ambos datos
if($lat == null || $long == null):
	die('Por favor ingrese latitud y longitud');
endif;

// Validacion del tipo de dato de la latitud
if(!preg_match("/^(-)?\d{1,3}\.[0-9]+$/", $lat)):
	die('Latitud no valida');
endif;

// Validacion del tipo de dato de la longitud
if(!preg_match("/^(-)?\d{1,3}\.[0-9]+$/", $long)):
	die('Longitud no valida');
endif;

$minLat = $lat - 20;
$minLong = $long - 20;
$maxLat = $lat + 20;
$maxLong = $long + 20;

# Posible error de conexión o fin de tiempo de espera
try {
	$tp = new TerminalPronostico($minLat, $minLat, $maxLat, $maxLong);
	die(json_encode($tp->getPuntos()));
} catch(\Exception $e) {
	die(json_encode(array()));
}
?>
